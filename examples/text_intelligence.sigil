//! Text Intelligence in Sigil
//!
//! AI-native text analysis for the modern AI-first language.
//! Features: similarity metrics, phonetic encoding, language detection,
//! LLM token counting, stemming, stopwords, n-grams, sentiment analysis,
//! sarcasm detection, NER, embeddings, and readability metrics.

fn main() {
    println("=== Sigil Text Intelligence Demo ===")
    println("")

    // =========================================================================
    // STRING SIMILARITY METRICS
    // =========================================================================
    println("--- String Similarity ---")

    let str1 = "kitten"
    let str2 = "sitting"

    println("Comparing: '" + str1 + "' vs '" + str2 + "'")
    println("  Levenshtein distance: " + to_string(levenshtein(str1, str2)))
    println("  Jaro-Winkler: " + to_string(jaro_winkler(str1, str2)))

    // Fuzzy matching
    let query = "hello"
    let candidates = ["hallo", "hello", "hullo", "help", "helicopter", "goodbye"]
    println("Fuzzy search for '" + query + "':")
    let matches = fuzzy_search(query, candidates, 3)
    println("  Top 3 matches: " + to_string(matches))

    println("")

    // =========================================================================
    // PHONETIC ENCODING
    // =========================================================================
    println("--- Phonetic Encoding ---")

    println("soundex('Smith'): " + soundex("Smith"))
    println("soundex('Smyth'): " + soundex("Smyth"))
    println("soundex_match('Smith', 'Smyth'): " + to_string(soundex_match("Smith", "Smyth")))
    println("metaphone('Stephen'): " + metaphone("Stephen"))
    println("cologne_phonetic('Müller'): " + cologne_phonetic("Muller"))

    println("")

    // =========================================================================
    // LANGUAGE DETECTION (15+ languages supported)
    // =========================================================================
    println("--- Language Detection ---")

    let texts = [
        "Hello, how are you today?",
        "Bonjour, comment allez-vous?",
        "Guten Tag, wie geht es Ihnen?",
        "Привет, как дела?",
    ]

    for text in texts {
        let lang = detect_language(text)
        println("'" + text + "' → " + lang)
    }

    println("")

    // =========================================================================
    // LLM TOKEN COUNTING (GPT-4/Claude compatible)
    // =========================================================================
    println("--- LLM Token Counting ---")

    let prompt = "What is the capital of France? Please provide a detailed answer."
    println("Text: '" + prompt + "'")
    println("  Token count: " + to_string(token_count(prompt)))

    let long_text = "This is a longer piece of text that we want to truncate."
    println("Truncated to 5 tokens: '" + truncate_tokens(long_text, 5) + "'")

    println("")

    // =========================================================================
    // STOPWORDS (15 languages!)
    // =========================================================================
    println("--- Stopwords (15 languages) ---")

    let sentence = "The quick brown fox jumps over the lazy dog"
    println("Original: '" + sentence + "'")
    println("Without stopwords: '" + remove_stopwords_text(sentence) + "'")

    println("Supported: en, de, fr, es, it, pt, nl, ru, ar, zh, ja, ko, hi, tr, pl, sv")

    println("")

    // =========================================================================
    // VADER-STYLE SENTIMENT ANALYSIS
    // =========================================================================
    println("--- VADER Sentiment Analysis ---")

    let positive = "I absolutely love this! It's amazing and wonderful!"
    let negative = "I hate this. It's terrible and disappointing."
    let mixed = "The movie was good but the ending was bad."

    println("Positive: '" + positive + "'")
    let pos_vader = sentiment_vader(positive)
    println("  Compound: " + to_string(pos_vader["compound"]))

    println("Negative: '" + negative + "'")
    let neg_vader = sentiment_vader(negative)
    println("  Compound: " + to_string(neg_vader["compound"]))

    println("Mixed: '" + mixed + "'")
    let mix_vader = sentiment_vader(mixed)
    println("  Compound: " + to_string(mix_vader["compound"]))

    println("")

    // =========================================================================
    // EMOTION DETECTION
    // =========================================================================
    println("--- Emotion Detection ---")

    let emotional = "I'm so happy and excited but also a bit nervous!"
    println("Text: '" + emotional + "'")
    let emotions = emotion_detect(emotional)
    println("  Emotions: " + to_string(emotions))

    println("")

    // =========================================================================
    // SARCASM DETECTION
    // =========================================================================
    println("--- Sarcasm Detection ---")

    let sarcastic_texts = [
        "Oh great, another meeting. Just what I needed.",
        "Wow, what a 'genius' move. /s",
        "Yeah right, that's totally going to work.",
        "I had a productive day at work today.",  // Not sarcastic
    ]

    for text in sarcastic_texts {
        let result = detect_sarcasm(text)
        let is_sarc = if result["score"] > 0.3 { "SARCASTIC" } else { "sincere" }
        println("'" + text + "'")
        println("  → " + is_sarc + " (score: " + to_string(result["score"]) + ")")
        if len(result["markers"]) > 0 {
            println("  Markers: " + to_string(result["markers"]))
        }
    }

    println("")

    // =========================================================================
    // NAMED ENTITY RECOGNITION
    // =========================================================================
    println("--- Named Entity Recognition ---")

    let text_with_entities = "Contact john@example.com or call 555-123-4567. " +
                             "Visit https://example.com for $99.99 on January 15, 2024. " +
                             "#AI @openai"

    println("Text: '" + text_with_entities + "'")
    println("  Emails: " + to_string(extract_emails(text_with_entities)))
    println("  URLs: " + to_string(extract_urls(text_with_entities)))
    println("  Phone: " + to_string(extract_phone_numbers(text_with_entities)))
    println("  Money: " + to_string(extract_money(text_with_entities)))
    println("  Dates: " + to_string(extract_dates(text_with_entities)))
    println("  Hashtags: " + to_string(extract_hashtags(text_with_entities)))
    println("  Mentions: " + to_string(extract_mentions(text_with_entities)))

    println("")

    // =========================================================================
    // TEXT EMBEDDINGS
    // =========================================================================
    println("--- Text Embeddings (Hash-based) ---")

    let doc1 = "The quick brown fox jumps over the lazy dog"
    let doc2 = "A fast brown fox leaps over a sleepy dog"
    let doc3 = "Machine learning is transforming artificial intelligence"

    println("Doc1: '" + doc1 + "'")
    println("Doc2: '" + doc2 + "'")
    println("Doc3: '" + doc3 + "'")
    println("")
    println("Embedding similarity:")
    println("  Doc1 vs Doc2: " + to_string(text_similarity_embedding(doc1, doc2)))
    println("  Doc1 vs Doc3: " + to_string(text_similarity_embedding(doc1, doc3)))

    let fp1 = text_fingerprint(doc1)
    let fp2 = text_fingerprint(doc2)
    println("")
    println("Text fingerprints:")
    println("  Doc1: " + fp1)
    println("  Doc2: " + fp2)

    println("")

    // =========================================================================
    // READABILITY METRICS
    // =========================================================================
    println("--- Readability Metrics ---")

    let simple = "The cat sat on the mat. It was a nice day."
    let complex = "The epistemological implications of quantum mechanics necessitate a reevaluation of our ontological assumptions regarding the nature of reality."

    println("Simple text: '" + simple + "'")
    println("  Flesch Reading Ease: " + to_string(flesch_reading_ease(simple)))
    println("  Grade Level: " + to_string(flesch_kincaid_grade(simple)))
    println("  Reading time: " + to_string(reading_time(simple)) + " min")

    println("")
    println("Complex text:")
    println("  Flesch Reading Ease: " + to_string(flesch_reading_ease(complex)))
    println("  Grade Level: " + to_string(flesch_kincaid_grade(complex)))

    println("")

    // =========================================================================
    // TEXT PREPROCESSING
    // =========================================================================
    println("--- Text Preprocessing ---")

    let messy = "  Hello, WORLD!!!   How ARE you???  "
    println("Original: '" + messy + "'")
    println("Preprocessed: '" + preprocess_text(messy) + "'")

    println("")

    // =========================================================================
    // INTENSITY AND FORMALITY
    // =========================================================================
    println("--- Intensity & Formality ---")

    let intense = "This is ABSOLUTELY AMAZING!!! I'm SO excited!!!"
    let formal = "Therefore, I would like to respectfully request furthermore information."
    let casual = "gonna wanna lol yeah that's kinda cool"

    println("Intensity of '" + intense + "':")
    println("  Score: " + to_string(intensity_score(intense)))

    println("")
    println("Formality scores (0=informal, 1=formal):")
    println("  Formal text: " + to_string(text_formality(formal)))
    println("  Casual text: " + to_string(text_formality(casual)))

    println("")
    println("=== Text Intelligence Demo Complete ===")
    println("")
    println("Total new functions in this module: ~40")
    println("Total text functions in Sigil: ~140")

    return 0
}
