//! Polycultural Text Processing in Sigil
//!
//! Sigil's philosophy: Mathematics is poly-cultural, and so is TEXT.
//! This example demonstrates world-class text handling for ALL writing systems.

fn main() {
    println("=== Sigil Polycultural Text Processing ===")
    println("")

    // =========================================================================
    // SCRIPT DETECTION
    // =========================================================================
    println("--- Script Detection ---")

    // Detect scripts in multilingual text
    let texts = [
        "Hello, World!",           // Latin
        "Ù…Ø±Ø­Ø¨Ø§ Ø¨Ø§Ù„Ø¹Ø§Ù„Ù…",            // Arabic
        "×©×œ×•× ×¢×•×œ×",               // Hebrew
        "ĞŸÑ€Ğ¸Ğ²ĞµÑ‚ Ğ¼Ğ¸Ñ€",              // Cyrillic
        "ã“ã‚“ã«ã¡ã¯ä¸–ç•Œ",            // Japanese (Hiragana + Kanji)
        "ì•ˆë…•í•˜ì„¸ìš” ì„¸ê³„",           // Korean (Hangul)
        "ä½ å¥½ä¸–ç•Œ",                 // Chinese (Han)
        "Î“ÎµÎ¹Î¬ ÏƒÎ¿Ï… ÎšÏŒÏƒÎ¼Îµ",          // Greek
        "à¤¨à¤®à¤¸à¥à¤¤à¥‡ à¤¦à¥à¤¨à¤¿à¤¯à¤¾",            // Devanagari (Hindi)
        "à¸ªà¸§à¸±à¸ªà¸”à¸µà¹‚à¸¥à¸",               // Thai
    ]

    for text in texts {
        let s = script(text)
        println(text + " â†’ " + s)
    }

    println("")

    // Check specific scripts
    println("is_latin('Hello'): " + to_string(is_latin("Hello")))
    println("is_arabic('Ù…Ø±Ø­Ø¨Ø§'): " + to_string(is_arabic("Ù…Ø±Ø­Ø¨Ø§")))
    println("is_cjk('ä½ å¥½'): " + to_string(is_cjk("ä½ å¥½")))
    println("is_cyrillic('ĞŸÑ€Ğ¸Ğ²ĞµÑ‚'): " + to_string(is_cyrillic("ĞŸÑ€Ğ¸Ğ²ĞµÑ‚")))

    println("")

    // =========================================================================
    // BIDIRECTIONAL TEXT (RTL/LTR)
    // =========================================================================
    println("--- Bidirectional Text ---")

    let arabic = "Ù…Ø±Ø­Ø¨Ø§ Ø¨Ø§Ù„Ø¹Ø§Ù„Ù…"
    let hebrew = "×©×œ×•× ×¢×•×œ×"
    let english = "Hello World"
    let mixed = "Hello Ù…Ø±Ø­Ø¨Ø§ World"

    println("Arabic direction: " + text_direction(arabic))
    println("Hebrew direction: " + text_direction(hebrew))
    println("English direction: " + text_direction(english))
    println("Mixed direction: " + text_direction(mixed))

    println("is_rtl(arabic): " + to_string(is_rtl(arabic)))
    println("is_bidi(mixed): " + to_string(is_bidi(mixed)))

    println("")

    // =========================================================================
    // DISPLAY WIDTH (CJK-aware)
    // =========================================================================
    println("--- Display Width ---")

    let latin_text = "Hello"
    let cjk_text = "ä½ å¥½"

    println("'" + latin_text + "' char_count: " + to_string(char_count(latin_text)))
    println("'" + latin_text + "' display_width: " + to_string(display_width(latin_text)))

    println("'" + cjk_text + "' char_count: " + to_string(char_count(cjk_text)))
    println("'" + cjk_text + "' display_width: " + to_string(display_width(cjk_text)))

    // CJK characters are full-width (2 columns each)
    println("is_fullwidth(cjk_text): " + to_string(is_fullwidth(cjk_text)))

    println("")

    // =========================================================================
    // TRANSLITERATION
    // =========================================================================
    println("--- Transliteration ---")

    let samples = [
        "ĞŸÑ€Ğ¸Ğ²ĞµÑ‚",          // Cyrillic â†’ Privet
        "åŒ—äº¬",            // Chinese â†’ Bei Jing
        "æ±äº¬",            // Japanese â†’ Dong Jing
        "Ù…Ø±Ø­Ø¨Ø§",           // Arabic â†’ mrhb
        "Î•Î»Î»Î·Î½Î¹ÎºÎ¬",        // Greek â†’ Ellenika
        "æ—¥æœ¬èª",          // Japanese â†’ Ri Ben Yu
        "cafÃ© rÃ©sumÃ©",     // French â†’ cafe resume
        "naÃ¯ve",           // â†’ naive
    ]

    for text in samples {
        let ascii = transliterate(text)
        println(text + " â†’ " + ascii)
    }

    println("")

    // URL-safe slugs from any language
    println("Slugify examples:")
    println("slugify('ĞŸÑ€Ğ¸Ğ²ĞµÑ‚ ĞœĞ¸Ñ€!'): " + slugify("ĞŸÑ€Ğ¸Ğ²ĞµÑ‚ ĞœĞ¸Ñ€!"))
    println("slugify('åŒ—äº¬ 2024'): " + slugify("åŒ—äº¬ 2024"))
    println("slugify('CafÃ© RÃ©sumÃ©'): " + slugify("CafÃ© RÃ©sumÃ©"))

    println("")

    // =========================================================================
    // DIACRITICS
    // =========================================================================
    println("--- Diacritics ---")

    let accented = "cafÃ© rÃ©sumÃ© naÃ¯ve"
    println("Original: " + accented)
    println("Stripped: " + strip_diacritics(accented))
    println("has_diacritics: " + to_string(has_diacritics(accented)))
    println("has_diacritics('hello'): " + to_string(has_diacritics("hello")))

    println("")

    // =========================================================================
    // LOCALE-AWARE CASE MAPPING
    // =========================================================================
    println("--- Locale-Aware Case Mapping ---")

    // Turkish: i â†” Ä° (dotted), Ä± â†” I (dotless)
    let turkish_text = "istanbul"
    println("Turkish uppercase 'istanbul': " + upper_locale(turkish_text, "tr"))
    println("English uppercase 'istanbul': " + upper_locale(turkish_text, "en"))

    // German: ÃŸ â†’ SS
    let german_text = "straÃŸe"
    println("German uppercase 'straÃŸe': " + upper_locale(german_text, "de"))

    // Case folding for comparison
    println("case_fold('HELLO'): " + case_fold("HELLO"))
    println("case_insensitive_eq('HELLO', 'hello'): " + to_string(case_insensitive_eq("HELLO", "hello")))

    println("")

    // =========================================================================
    // LOCALE-AWARE SORTING
    // =========================================================================
    println("--- Locale-Aware Sorting ---")

    // Swedish: Ã¤ comes after z
    // German: Ã¤ sorts with a
    let words = ["Ã¤pple", "zebra", "apple", "Ã¶l"]

    println("Words: " + to_string(words))
    println("Swedish sort: " + to_string(sort_locale(words, "sv")))
    println("German sort: " + to_string(sort_locale(words, "de")))
    println("English sort: " + to_string(sort_locale(words, "en")))

    println("")

    // =========================================================================
    // ADVANCED SEGMENTATION
    // =========================================================================
    println("--- Advanced Segmentation ---")

    // Sentence segmentation
    let paragraph = "Hello! How are you? I'm fine. Thanks for asking."
    println("Sentences: " + to_string(sentences(paragraph)))
    println("Sentence count: " + to_string(sentence_count(paragraph)))

    // ICU word segmentation (works with Thai, CJK)
    let thai = "à¸ªà¸§à¸±à¸ªà¸”à¸µà¸„à¸£à¸±à¸šà¸œà¸¡à¸Šà¸·à¹ˆà¸­à¸ˆà¸­à¸«à¹Œà¸™"  // Thai has no spaces between words
    println("Thai text: " + thai)
    println("Thai words (ICU): " + to_string(words_icu(thai)))
    println("Thai word count: " + to_string(word_count_icu(thai)))

    let chinese = "æˆ‘çˆ±åŒ—äº¬å¤©å®‰é—¨"
    println("Chinese text: " + chinese)
    println("Chinese words (ICU): " + to_string(words_icu(chinese)))

    println("")

    // =========================================================================
    // EMOJI HANDLING
    // =========================================================================
    println("--- Emoji Handling ---")

    let emoji_text = "Hello ğŸ‘‹ World ğŸŒ! How are you? ğŸ˜Š"
    println("Text: " + emoji_text)
    println("is_emoji: " + to_string(is_emoji(emoji_text)))
    println("extract_emoji: " + to_string(extract_emoji(emoji_text)))
    println("strip_emoji: " + strip_emoji(emoji_text))

    // Complex emoji (family with ZWJ)
    let family = "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦"
    println("Family emoji grapheme_count: " + to_string(grapheme_count(family)))
    println("Family emoji char_count: " + to_string(char_count(family)))

    println("")

    // =========================================================================
    // MIXED SCRIPT TEXT
    // =========================================================================
    println("--- Mixed Script Text ---")

    let mixed_text = "Helloä¸–ç•ŒĞŸÑ€Ğ¸Ğ²ĞµÑ‚"
    println("Mixed text: " + mixed_text)
    println("Scripts present: " + to_string(scripts(mixed_text)))
    println("Script runs: " + to_string(script_runs(mixed_text)))

    println("")

    // =========================================================================
    // GRAPHEME-CORRECT OPERATIONS
    // =========================================================================
    println("--- Grapheme-Correct Operations ---")

    // Combining characters
    let combining = "Ã©"  // e + combining acute (2 code points, 1 grapheme)
    println("Combining 'Ã©' grapheme_count: " + to_string(grapheme_count(combining)))

    // Grapheme-correct reverse
    let with_emoji = "HelloğŸ‘‹World"
    println("Original: " + with_emoji)
    println("grapheme_reverse: " + grapheme_reverse(with_emoji))

    // Grapheme slicing
    let text = "HÃ©lloğŸŒWÃ¶rld"
    println("grapheme_slice(0, 5): " + grapheme_slice(text, 0, 5))

    println("")
    println("=== Polycultural Text Demo Complete ===")

    return 0
}
